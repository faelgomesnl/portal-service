<link rel="stylesheet" href="/css/styles.css">

{{#if user.CONT_OI}}
<div class="container p-4">
    <div class="row">
        <div class="col-md-5 mx-auto">

            <div class="card">
                <div class="card-body">
                    <form action="/links/orderserv" method="POST" id="frm_" enctype="multipart/form-data">


                        <div class="form-group">
                            <textarea type="text" name="texto" class="form-control" required></textarea>
                        </div>

                        <div class="form-group">
                            <select class="select-css" name="contrato" id="list" onChange="update()">
                                <option selected disabled>Contrato/ Parceiro </option>
                                <option selected disabled>Escolha Um Circuito </option>

                                {{#each geral}}
                                <option value="{{NUM_CONTRATO}}" id="{{CODPARC}}" title="{{CODPROD}}"
                                    ren="{{VALORTEMPO}}" ren2="{{CIDADE}}" ren3="{{LOGRADOURO}}" ren4="{{NOMEPARC}}"
                                    ren5="{{CARTEIRA}}" ren6="{{CODUSUOS}}" ren7="{{CODCARGAHOR}}" ren8="{{CODPARCSEC}}"
                                    ren9="{{ID_LOGIN}}" ren10="{{UFCONT}}">
                                    {{AD_CIRCUITO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        {{!-- escolha de produto --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list3" onChange="update()">
                                {{#each prod}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui2" onclick="update4()" required>
                                <option value="" disabled selected>Escolha Um Serviço</option>
                            </select>
                        </div>

                        {{!-- escolha de serviço --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list4" onChange="update()">
                                {{#each prod1}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui3" onclick="update3()" required>
                                <option value="" disabled selected>Escolha Um Produto</option>
                            </select>
                        </div>

                        {{!-- escolha de contato --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="contato" id="list2" onChange="update()">

                                {{#each cont}}
                                <option value="{{CONTATO}}" id="{{CODCONT}}">
                                    {{CONTATO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui" onclick="update2()" required>
                                <option value="" disabled selected>Escolha Contato Responsável</option>
                            </select>
                        </div>

                        {{!-- armazena valores envio req.body insert --}}
                        <div class="form-group">
                            <input hidden id="value" required>
                            <input hidden id="codparc" name="codparc" required>
                            <input hidden id="codprod" name="codprod" required>
                            <input hidden id="codserv" name="codserv" required>
                            <input hidden id="atualiza" name="atualiza" required>
                            <input hidden id="sla" name="sla" required>
                            <input hidden id="carteira" name="carteira" required>
                            <input hidden id="usuweb" name="usuweb" required>
                            <input hidden id="cargahora" name="cargahora">
                            <input hidden id="adlocalidade" name="adlocalidade">
                            <input hidden id="loginuser" name="loginuser">
                            <input hidden id="ufcont" name="ufcont">

                            {{!-- exibição enderaço --}}
                            <input hidden type="text" id="cidade" name="cidade" disabled="disabled" style='width:100%'>
                            <input hidden type="text" id="logradouro" name="logradouro" disabled="disabled"
                                style='width:100%'>
                            <input hidden type="text" id="parceiro" name="parceiro" disabled="disabled"
                                style='width:100%'>
                        </div>

                        <div class="form-group">
                            <button class="btn btn-success btn-block">
                                Gerar Ordem De Serviço
                            </button>
                        </div>
                    </form>

                </div>
            </div>
        </div>

    </div>
</div>

{{else}}

{{#if user.AD_SERVICE}}
<div class="container p-4">
    <div class="row">
        <div class="col-md-5 mx-auto">

            <div class="card">
                <div class="card-body">
                    <form action="/links/orderserv" method="POST" id="frm_" enctype="multipart/form-data">


                        <div class="form-group">
                            <textarea type="text" name="texto" class="form-control">Nome:
Setor:   
Ramal:   
Descrição Do Problema:</textarea>
                        </div>

                        <div class="form-group">
                            <select class="select-css" name="contrato" id="list" onChange="update()">
                                <option selected disabled>Contrato/ Parceiro </option>
                                <option selected disabled>Escolha Uma Localidade </option>

                                {{#each geral}}
                                <option value="{{NUM_CONTRATO}}" id="{{CODPARC}}" title="{{CODPROD}}"
                                    ren="{{VALORTEMPO}}" ren2="{{CIDADE}}" ren3="{{LOGRADOURO}}" ren4="{{NOMEPARC}}"
                                    ren5="{{CARTEIRA}}" ren6="{{CODUSUOS}}" ren7="{{CODCARGAHOR}}" ren8="{{CODPARCSEC}}"
                                    ren9="{{ID_LOGIN}}" ren10="{{UFCONT}}">
                                    {{NOMEPARC}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        {{!-- escolha de produto --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list3" onChange="update()">
                                {{#each prod}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui2" onclick="update4()" required>
                                <option value="" disabled selected>Escolha Um Serviço</option>
                            </select>
                        </div>

                        {{!-- escolha de serviço --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list4" onChange="update()">
                                {{#each prod1}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui3" onclick="update3()" required>
                                <option value="" disabled selected>Escolha Um Produto</option>
                            </select>
                        </div>

                        {{!-- escolha de contato --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="contato" id="list2" onChange="update()">

                                {{#each cont}}
                                <option value="{{CONTATO}}" id="{{NOME}}">
                                    {{CONTATO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui" onclick="update2()" required>
                                <option value="" disabled selected>Escolha Contato Responsável</option>
                            </select>
                        </div>

                        {{!-- armazena valores envio req.body insert --}}
                        <div class="form-group">
                            <input hidden id="value" required>
                            <input hidden id="codparc" name="codparc" required>
                            <input hidden id="codprod" name="codprod" required>
                            <input hidden id="codserv" name="codserv" required>
                            <input hidden id="atualiza" name="atualiza" required>
                            <input hidden id="sla" name="sla">
                            <input hidden id="carteira" name="carteira" required>
                            <input hidden id="usuweb" name="usuweb" required>
                            <input hidden id="cargahora" name="cargahora">
                            <input hidden id="adlocalidade" name="adlocalidade">
                            <input hidden id="loginuser" name="loginuser">
                            <input hidden id="ufcont" name="ufcont">

                            {{!-- exibição enderaço --}}
                            <input hidden type="text" id="cidade" name="cidade" disabled="disabled" style='width:100%'>
                            <input hidden type="text" id="logradouro" name="logradouro" disabled="disabled"
                                style='width:100%'>
                            <input hidden type="text" id="parceiro" name="parceiro" disabled="disabled"
                                style='width:100%'>
                        </div>

                        <div class="form-group">
                            <button class="btn btn-success btn-block" onclick="valida()">
                                Gerar Ordem De Serviço
                            </button>
                    </form>

                </div>
            </div>
        </div>

    </div>
</div>
{{else}}

{{#if user.AD_ABERTURACO}}

<div class="container p-4">
    <div class="row">
        <div class="col-md-7 mx-auto">

            <div class="card">
                <div class="card-body">
                    <form action="/links/orderserv" method="POST" id="frm_" enctype="multipart/form-data">


                        <div class="form-group">
                            <textarea type="text" name="texto" class="form-control" required></textarea>
                        </div>

                        <div class="form-group">
                            <select class="select-css" name="contrato" id="list" onChange="update()">
                                <option selected disabled>Parceiro / Localidade / Solução / Circuito </option>
                                <option selected disabled>Escolha Uma Localidade </option>

                                {{#each geral}}
                                <option value="{{NUM_CONTRATO}}" id="{{CODPARC}}" title="{{CODPROD}}"
                                    ren="{{VALORTEMPO}}" ren2="{{CIDADE}}" ren3="{{LOGRADOURO}}" ren4="{{NOMEPARC}}"
                                    ren5="{{CARTEIRA}}" ren6="{{CODUSUOS}}" ren7="{{CODCARGAHOR}}" ren8="{{CODPARCSEC}}"
                                    ren9="{{ID_LOGIN}}" ren10="{{UFCONT}}">
                                    {{NOMEPARC}} / {{AD_LOCALIDADE}} / {{AD_TSOLUCAO}} / {{AD_CIRCUITO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        {{!-- escolha de produto --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list3" onChange="update()">
                                {{#each prod}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui2" onclick="update4()" required>
                                <option value="" disabled selected>Escolha Um Serviço</option>
                            </select>
                        </div>

                        {{!-- escolha de serviço --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list4" onChange="update()">
                                {{#each prod1}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui3" onclick="update3()" required>
                                <option value="" disabled selected>Escolha Um Produto</option>
                            </select>
                        </div>

                        {{!-- escolha de contato --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="contato" id="list2" onChange="update()">

                                {{#each cont}}
                                <option value="{{CONTATO}}" id="{{NOME}}">
                                    {{CONTATO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui" onclick="update2()" required>
                                <option value="" disabled selected>Escolha Contato Responsável</option>
                            </select>
                        </div>

                        {{!-- armazena valores envio req.body insert --}}
                        <div class="form-group">
                            <input hidden id="value" required>
                            <input hidden id="codparc" name="codparc" required>
                            <input hidden id="codprod" name="codprod" required>
                            <input hidden id="codserv" name="codserv" required>
                            <input hidden id="atualiza" name="atualiza" required>
                            <input hidden id="sla" name="sla">
                            <input hidden id="carteira" name="carteira" required>
                            <input hidden id="usuweb" name="usuweb" required>
                            <input hidden id="cargahora" name="cargahora">
                            <input hidden id="adlocalidade" name="adlocalidade">
                            <input hidden id="loginuser" name="loginuser">
                            <input hidden id="ufcont" name="ufcont">

                            {{!-- exibição enderaço --}}
                            <input  type="text" id="cidade" name="cidade" disabled="disabled" style='width:100%'>
                            <input  type="text" id="logradouro" name="logradouro" disabled="disabled"
                                style='width:100%'>
                            <input  type="text" id="parceiro" name="parceiro" disabled="disabled"
                                style='width:100%'>
                        </div>

                        <div class="form-group">
                            <button class="btn btn-success btn-block" onclick="valida()">
                                Gerar Ordem De Serviço
                            </button>
                    </form>

                </div>
            </div>
        </div>

    </div>
</div>

{{else}}
<div class="container p-4">
    <div class="row">
        <div class="col-md-5 mx-auto">

            <div class="card">
                <div class="card-body">
                    <form action="/links/orderserv" method="POST" id="frm_" enctype="multipart/form-data">


                        <div class="form-group">
                            <textarea type="text" name="texto" class="form-control" required></textarea>
                        </div>

                        <div class="form-group">
                            <select class="select-css" name="contrato" id="list" onChange="update()">
                                <option selected disabled>Contrato/ Parceiro </option>
                                <option selected disabled>Escolha Uma Localidade </option>

                                {{#each geral}}
                                <option value="{{NUM_CONTRATO}}" id="{{CODPARC}}" title="{{CODPROD}}"
                                    ren="{{VALORTEMPO}}" ren2="{{CIDADE}}" ren3="{{LOGRADOURO}}" ren4="{{NOMEPARC}}"
                                    ren5="{{CARTEIRA}}" ren6="{{CODUSUOS}}" ren7="{{CODCARGAHOR}}" ren8="{{CODPARCSEC}}"
                                    ren9="{{ID_LOGIN}}" ren10="{{UFCONT}}">
                                    {{NOMEPARC}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        {{!-- escolha de produto --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list3" onChange="update()">
                                {{#each prod}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui2" onclick="update4()" required>
                                <option value="" disabled selected>Escolha Um Serviço</option>
                            </select>
                        </div>

                        {{!-- escolha de serviço --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="produto" id="list4" onChange="update()">
                                {{#each prod1}}
                                <option value="{{PRODUTO}}" id="{{PRODUTO}}">
                                    {{PRODUTO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui3" onclick="update3()" required>
                                <option value="" disabled selected>Escolha Um Produto</option>
                            </select>
                        </div>

                        {{!-- escolha de contato --}}
                        <div class="form-group" hidden>
                            <select class="select-css" name="contato" id="list2" onChange="update()">

                                {{#each cont}}
                                <option value="{{CONTATO}}" id="{{NOME}}">
                                    {{CONTATO}}
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group" id="updiv">
                            <select class="select-css" name="contato" id="aqui" onclick="update2()" required>
                                <option value="" disabled selected>Escolha Contato Responsável</option>
                            </select>
                        </div>

                        {{!-- armazena valores envio req.body insert --}}
                        <div class="form-group">
                            <input hidden id="value" required>
                            <input hidden id="codparc" name="codparc" required>
                            <input hidden id="codprod" name="codprod" required>
                            <input hidden id="codserv" name="codserv" required>
                            <input hidden id="atualiza" name="atualiza" required>
                            <input hidden id="sla" name="sla">
                            <input hidden id="carteira" name="carteira" required>
                            <input hidden id="usuweb" name="usuweb" required>
                            <input hidden id="cargahora" name="cargahora">
                            <input hidden id="adlocalidade" name="adlocalidade">
                            <input hidden id="loginuser" name="loginuser">
                            <input hidden id="ufcont" name="ufcont">

                            {{!-- exibição enderaço --}}
                            <input hidden type="text" id="cidade" name="cidade" disabled="disabled" style='width:100%'>
                            <input hidden type="text" id="logradouro" name="logradouro" disabled="disabled"
                                style='width:100%'>
                            <input hidden type="text" id="parceiro" name="parceiro" disabled="disabled"
                                style='width:100%'>
                        </div>

                        <div class="form-group">
                            <button class="btn btn-success btn-block" onclick="valida()">
                                Gerar Ordem De Serviço
                            </button>
                    </form>

                </div>
            </div>
        </div>

    </div>
</div>
{{/if}}
{{/if}}
{{/if}}

{{!-- RECEBE O VALOR INFORMADO NO SELECT A TRIBUI A INPUT PARA REGISTRAR O CODPARC --}}
<script type="text/javascript">
    function valida() {
        if (document.getElementById("codprod").value == "") {
            alert('Por favor selecione o Serviço na lista abaixo. Caso não tenha um Serviço listado entre em contato com manutencao@metodotelecom.com.br');
            document.getElementById("codprod").focus();
            return false
        }
        if (document.getElementById("codserv").value == "") {
            alert('Por favor, selecione um Produto na lista abaixo');
            document.getElementById("codserv").focus();
            return false
        }
        if (document.getElementById("atualiza").value == "") {
            alert('Por favor, selecione um Contato lista abaixo');
            document.getElementById("atualiza").focus();
            return false
        }
    }

    function update() {
        var select = document.getElementById('list');
        var option = select.options[select.selectedIndex];

        //busca valor contrato
        var contrato = option.value;
        var contr = contrato.toString();

        document.getElementById('value').value = option.value;
        document.getElementById('codparc').value = option.id;
        document.getElementById('codprod').value = option.title;

        //busca o sla/ carteira/ Executante Padrão da OSWEB referente ao contrato

        var ren = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren');
        var ren5 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren5');
        var ren6 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren6');
        var ren7 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren7');
        var ren8 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren8');
        var ren9 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren9');
        var ren10 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren10');


        document.getElementById('sla').value = ren
        document.getElementById('carteira').value = ren5
        document.getElementById('usuweb').value = ren6
        document.getElementById('cargahora').value = ren7
        document.getElementById('adlocalidade').value = ren8
        document.getElementById('loginuser').value = ren9
        document.getElementById('ufcont').value = ren10

        //lista endereço da localidade escolhida
        var ren2 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren2');
        var ren3 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren3');
        var ren4 = document.forms['frm_'].elements['list'].options[document.forms['frm_'].elements['list'].selectedIndex].getAttribute('ren4');

        document.getElementById('cidade').value = ren2
        document.getElementById('logradouro').value = ren3
        document.getElementById('parceiro').value = ren4


        //busca valor dos contatos
        var select = document.getElementById('list2');
        var option = select.options[select.selectedIndex];
        var contatos = option.value
        const languagesList = contatos

        //pega o select referente ao contato
        var select = document.getElementById("list2");

        //cria uma lista vazia 
        var vlroption = []

        //le o select e pega somente os valores e adiciona em uma nova lista                
        for (i = 0; i < select.length; i = i + 1) {
            vlroption.push(select.options[i].value)
        }

        // altera o contato a medida que muda localidade.
        var sel = document.getElementById('aqui');
        for (i = sel.length - 1; i >= 0; i--) {
            sel.options.remove(i);
        }

        //le os dados que foram armazenados e insere na lista
        for (k = 0; k < vlroption.length; k = k + 1) {

            if (vlroption[k].match(contr)) {
                //insere os itens no select option
                var option = new Option(vlroption[k], vlroption[k]);
                var select = document.getElementById("aqui");
                select.add(option);
            }
        }

        //pega o select referente ao produto
        var select = document.getElementById("list3");
        //cria uma lista vazia 
        var vlroption = []

        //le o select e pega somente os valores e adiciona em uma nova lista
        for (i = 0; i < select.length; i = i + 1) {
            vlroption.push(select.options[i].value)
        }

        // altera o contato a medida que muda produto.
        var sel = document.getElementById('aqui2');
        for (i = sel.length - 1; i >= 0; i--) {
            sel.options.remove(i);
        }

        //le os dados que foram armazenados e insere na lista
        // console.log("Lista Preenchida")
        for (k = 0; k < vlroption.length; k = k + 1) {
            if (vlroption[k].match(contr)) {

                //insere os itens no select option
                var option = new Option(vlroption[k], vlroption[k]);
                var select = document.getElementById("aqui2");
                select.add(option);
            }
        }

        //pega o select referente ao serviço
        var select = document.getElementById("list4");
        //cria uma lista vazia 
        var vlroption = []

        //le o select e pega somente os valores e adiciona em uma nova lista
        for (i = 0; i < select.length; i = i + 1) {
            vlroption.push(select.options[i].value)
        }

        // altera o contato a medida que muda produto.
        var sel = document.getElementById('aqui3');
        for (i = sel.length - 1; i >= 0; i--) {
            sel.options.remove(i);
        }

        //le os dados que foram armazenados e insere na lista
        //console.log("Lista Preenchida")
        for (k = 0; k < vlroption.length; k = k + 1) {
            if (vlroption[k].match(contr)) {

                //insere os itens no select option
                var option = new Option(vlroption[k], vlroption[k]);
                var select = document.getElementById("aqui3");
                select.add(option);
            }
        }
    }

    //insere o código do contato no respectivo input
    function update2() {
        var select = document.getElementById('aqui');
        var option = select.options[select.selectedIndex];
        var novo = option.text.split("-").pop()
        document.getElementById('atualiza').value = novo;
    }

    //insere o código do serviço no respectivo input
    function update3() {
        var select = document.getElementById('aqui3');
        var option = select.options[select.selectedIndex];
        var novo = option.text.split("-").pop()
        document.getElementById('codserv').value = novo;
    }

    //insere o código do produto no respectivo input
    function update4() {
        var select = document.getElementById('aqui2');
        var option = select.options[select.selectedIndex];
        var novo = option.text.split("-").pop()
        document.getElementById('codprod').value = novo;
    }            
</script>